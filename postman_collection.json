{
  "info": {
    "name": "MusicShop - Complete API Collection",
    "description": "Unified collection for testing all MusicShop APIs:\n- SOAP API (InstrumentosAPI) - Direct and via REST\n- gRPC API (SellerApi) - Direct gRPC and via REST\n\nIncludes success and error test cases for all endpoints.\nAll REST requests include authentication with OAuth2 Bearer token.\n\nFor gRPC Direct tests: Postman v9+ natively supports gRPC.\nImport the proto file: SellerApi/protos/seller.proto",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{access_token}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8088",
      "type": "string"
    },
    {
      "key": "soap_url",
      "value": "http://localhost:4567",
      "type": "string"
    },
    {
      "key": "grpc_host",
      "value": "localhost:50052",
      "type": "string"
    },
    {
      "key": "access_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "instrument_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "seller_id",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Setup",
      "item": [
        {
          "name": "Get OAuth2 Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('access_token', jsonData.access_token);",
                  "    console.log('Access token saved:', jsonData.access_token);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "grant_type",
                  "value": "client_credentials"
                },
                {
                  "key": "client_id",
                  "value": "musicshop"
                },
                {
                  "key": "client_secret",
                  "value": "secret"
                },
                {
                  "key": "scope",
                  "value": "read write"
                }
              ]
            },
            "url": {
              "raw": "http://localhost:4444/oauth2/token",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4444",
              "path": ["oauth2", "token"]
            }
          }
        }
      ]
    },
    {
      "name": "SOAP Direct",
      "item": [
        {
          "name": "✅ List All",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Is XML', () => pm.expect(pm.response.headers.get('Content-Type')).to.include('xml'));"
                ]
              }
            }
          ],
          "request": {
            "auth": {"type": "noauth"},
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "text/xml; charset=utf-8"},
              {"key": "SOAPAction", "value": "urn:InstrumentosService#list"}
            ],
            "body": {
              "mode": "raw",
              "raw": "<?xml version=\"1.0\"?>\n<env:Envelope xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:tns=\"urn:InstrumentosService\">\n  <env:Body>\n    <tns:list/>\n  </env:Body>\n</env:Envelope>"
            },
            "url": "{{soap_url}}/soap"
          }
        },
        {
          "name": "✅ Create",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "const id = pm.response.text().match(/<id>(\\d+)<\\/id>/)?.[1];",
                  "if(id) pm.collectionVariables.set('instrument_id', id);"
                ]
              }
            }
          ],
          "request": {
            "auth": {"type": "noauth"},
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "text/xml"},
              {"key": "SOAPAction", "value": "urn:InstrumentosService#create"}
            ],
            "body": {
              "mode": "raw",
              "raw": "<?xml version=\"1.0\"?>\n<env:Envelope xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:tns=\"urn:InstrumentosService\">\n  <env:Body>\n    <tns:create>\n      <name>Guitar</name>\n      <category>String</category>\n      <price>999</price>\n      <stock>10</stock>\n    </tns:create>\n  </env:Body>\n</env:Envelope>"
            },
            "url": "{{soap_url}}/soap"
          }
        },
        {
          "name": "❌ Create - No Price",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 400 (Fault)', () => pm.response.to.have.status(400));",
                  "pm.test('Has Fault', () => pm.expect(pm.response.text()).to.include('Fault'));"
                ]
              }
            }
          ],
          "request": {
            "auth": {"type": "noauth"},
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "text/xml"},
              {"key": "SOAPAction", "value": "urn:InstrumentosService#create"}
            ],
            "body": {
              "mode": "raw",
              "raw": "<?xml version=\"1.0\"?>\n<env:Envelope xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:tns=\"urn:InstrumentosService\">\n  <env:Body>\n    <tns:create>\n      <name>Invalid</name>\n      <category>Test</category>\n      <stock>5</stock>\n    </tns:create>\n  </env:Body>\n</env:Envelope>"
            },
            "url": "{{soap_url}}/soap"
          }
        },
        {
          "name": "✅ Get by ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Has nombre', () => pm.expect(pm.response.text()).to.include('<nombre>'));"
                ]
              }
            }
          ],
          "request": {
            "auth": {"type": "noauth"},
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "text/xml"},
              {"key": "SOAPAction", "value": "urn:InstrumentosService#find"}
            ],
            "body": {
              "mode": "raw",
              "raw": "<?xml version=\"1.0\"?>\n<env:Envelope xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:tns=\"urn:InstrumentosService\">\n  <env:Body>\n    <tns:find><id>{{instrument_id}}</id></tns:find>\n  </env:Body>\n</env:Envelope>"
            },
            "url": "{{soap_url}}/soap"
          }
        },
        {
          "name": "❌ Get - Not Found",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Empty Response', () => pm.expect(pm.response.text()).to.include('GetInstrumentResponse'));"
                ]
              }
            }
          ],
          "request": {
            "auth": {"type": "noauth"},
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "text/xml"},
              {"key": "SOAPAction", "value": "urn:InstrumentosService#find"}
            ],
            "body": {
              "mode": "raw",
              "raw": "<?xml version=\"1.0\"?>\n<env:Envelope xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:tns=\"urn:InstrumentosService\">\n  <env:Body>\n    <tns:find><id>999999</id></tns:find>\n  </env:Body>\n</env:Envelope>"
            },
            "url": "{{soap_url}}/soap"
          }
        }
      ]
    },
    {
      "name": "SOAP via REST",
      "item": [
        {
          "name": "✅ List",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));", "pm.test('Has embedded', () => pm.expect(pm.response.json()._embedded).to.exist);"]}}],
          "request": {"method": "GET", "url": "{{base_url}}/instruments"}
        },
        {
          "name": "✅ Create",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 201', () => pm.response.to.have.status(201));", "const j = pm.response.json();", "if(j.id) pm.collectionVariables.set('instrument_id', j.id);"]}}],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"nombre\":\"Piano\",\"marca\":\"Yamaha\",\"modelo\":\"P125\",\"precio\":2500,\"anio\":2023,\"categoria\":\"Keys\"}"},
            "url": "{{base_url}}/instruments"
          }
        },
        {
          "name": "❌ Create - Bad Price",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));", "pm.test('Has error', () => pm.expect(pm.response.json().error).to.exist);"]}}],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"nombre\":\"Bad\",\"marca\":\"Test\",\"modelo\":\"X\",\"precio\":-10,\"anio\":2024,\"categoria\":\"Test\"}"},
            "url": "{{base_url}}/instruments"
          }
        },
        {
          "name": "❌ Create - No Auth",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));", "pm.test('Token error', () => pm.expect(pm.response.json().error).to.include('token'));"]}}],
          "request": {
            "auth": {"type": "noauth"},
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"nombre\":\"Test\",\"marca\":\"T\",\"modelo\":\"X\",\"precio\":100,\"anio\":2024,\"categoria\":\"T\"}"},
            "url": "{{base_url}}/instruments"
          }
        },
        {
          "name": "✅ Get by ID",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));", "pm.test('Has data', () => {const j=pm.response.json(); pm.expect(j.nombre).to.exist;});"]}}],
          "request": {"method": "GET", "url": "{{base_url}}/instruments/{{instrument_id}}"}
        },
        {
          "name": "❌ Get - Not Found",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 404', () => pm.response.to.have.status(404));", "pm.test('Has error', () => pm.expect(pm.response.json().error).to.exist);"]}}],
          "request": {"method": "GET", "url": "{{base_url}}/instruments/999999"}
        },
        {
          "name": "✅ Update",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]}}],
          "request": {
            "method": "PUT",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"nombre\":\"Updated Piano\",\"marca\":\"Yamaha\",\"modelo\":\"P135\",\"precio\":2800,\"anio\":2024,\"categoria\":\"Keys\"}"},
            "url": "{{base_url}}/instruments/{{instrument_id}}"
          }
        },
        {
          "name": "✅ Delete",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 204', () => pm.response.to.have.status(204));"]}}],
          "request": {"method": "DELETE", "url": "{{base_url}}/instruments/{{instrument_id}}"}
        }
      ]
    },
    
    {
      "name": "gRPC via REST",
      "item": [
        {
          "name": "✅ Create (Client Stream)",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 201', () => pm.response.to.have.status(201));", "const j = pm.response.json();", "if(j.data?.seller_ids?.[0]) pm.collectionVariables.set('seller_id', j.data.seller_ids[0]);", "pm.test('Created 2', () => pm.expect(j.data.sellers_created).to.equal(2));", "const body = JSON.parse(pm.request.body.raw);", "if(body.sellers[0].email) pm.collectionVariables.set('test_email', body.sellers[0].email);", "if(body.sellers[0].name) pm.collectionVariables.set('seller_name', body.sellers[0].name);"]}}],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"sellers\":[{\"name\":\"Alice Johnson\",\"email\":\"alice.{{$timestamp}}@example.com\",\"age\":28,\"hire_date\":\"2024-01-15\",\"phone\":\"+111\",\"address\":\"111 St\",\"sales\":[{\"instrument_name\":\"Guitar\",\"amount\":1299,\"sale_date\":\"2024-11-01\"}]},{\"name\":\"Bob Smith\",\"email\":\"bob.{{$timestamp}}@example.com\",\"age\":32,\"hire_date\":\"2023-06-10\",\"phone\":\"+222\",\"address\":\"222 Ave\",\"sales\":[{\"instrument_name\":\"Drums\",\"amount\":2500,\"sale_date\":\"2024-10-20\"}]}]}"},
            "url": "{{base_url}}/api/sellers"
          }
        },
        {
          "name": "❌ Create - Bad Email",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400 or 420', () => pm.expect([400, 420]).to.include(pm.response.code));", "pm.test('Email error', () => pm.expect(pm.response.json().details || pm.response.json().message).to.match(/email/i));"]}}],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"sellers\":[{\"name\":\"Bad\",\"email\":\"not-email\",\"age\":25,\"hire_date\":\"2024-01-15\",\"phone\":\"+1\",\"address\":\"Test\"}]}"},
            "url": "{{base_url}}/api/sellers"
          }
        },
        {
          "name": "❌ Create - Age <18",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));", "pm.test('Age error', () => pm.expect(pm.response.json().details || pm.response.json().message).to.match(/age|18/i));"]}}],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"sellers\":[{\"name\":\"Minor\",\"email\":\"minor@t.com\",\"age\":16,\"hire_date\":\"2024-01-15\",\"phone\":\"+1\",\"address\":\"Test\"}]}"},
            "url": "{{base_url}}/api/sellers"
          }
        },
        {
          "name": "❌ Create - Duplicate",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));", "pm.test('Exists error', () => pm.expect(pm.response.json().details || pm.response.json().message).to.match(/exist|already|email/i));"]}}],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"sellers\":[{\"name\":\"Dup\",\"email\":\"{{test_email}}\",\"age\":30,\"hire_date\":\"2024-01-15\",\"phone\":\"+9\",\"address\":\"Dup\"}]}"},
            "url": "{{base_url}}/api/sellers"
          }
        },
        {
          "name": "❌ Create - No Auth",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));", "pm.test('Token error', () => pm.expect(pm.response.json().error).to.include('token'));"]}}],
          "request": {
            "auth": {"type": "noauth"},
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"sellers\":[{\"name\":\"T\",\"email\":\"t@t.com\",\"age\":25,\"hire_date\":\"2024-01-15\",\"phone\":\"+1\",\"address\":\"T\"}]}"},
            "url": "{{base_url}}/api/sellers"
          }
        },
        {
          "name": "✅ Search (Server Stream)",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));", "pm.test('Is Array', () => pm.expect(pm.response.json().data).to.be.an('array'));", "pm.test('Has results', () => pm.expect(pm.response.json().count).to.be.greaterThan(0));"]}}],
          "request": {"method": "GET", "url": "{{base_url}}/api/sellers/search/{{seller_name}}"}
        },
        {
          "name": "❌ Search - No Results",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 404', () => pm.response.to.have.status(404));", "pm.test('Has error', () => pm.expect(pm.response.json().error).to.exist);"]}}],
          "request": {"method": "GET", "url": "{{base_url}}/api/sellers/search/nonexistent999"}
        },
        {
          "name": "✅ Get by ID",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));", "pm.test('Has data', () => {const j=pm.response.json(); pm.expect(j.data.id).to.exist;});"]}}],
          "request": {"method": "GET", "url": "{{base_url}}/api/sellers/{{seller_id}}"}
        },
        {
          "name": "❌ Get - Not Found",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 404', () => pm.response.to.have.status(404));", "pm.test('Not found', () => pm.expect(pm.response.json().message).to.include('not found'));"]}}],
          "request": {"method": "GET", "url": "{{base_url}}/api/sellers/fake-uuid-999"}
        },
        {
          "name": "✅ Update",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));", "pm.test('Has data', () => pm.expect(pm.response.json().data).to.exist);"]}}],
          "request": {
            "method": "PUT",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"name\":\"Alice Updated\",\"email\":\"alice.updated.{{$timestamp}}@example.com\",\"age\":29,\"hire_date\":\"2024-01-15\",\"phone\":\"+111\",\"address\":\"111 Updated\",\"sales\":[{\"instrument_name\":\"Guitar\",\"amount\":1499,\"sale_date\":\"2024-11-01\"}]}"},
            "url": "{{base_url}}/api/sellers/{{seller_id}}"
          }
        },
        {
          "name": "❌ Update - Not Found",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 404', () => pm.response.to.have.status(404));"]}}],
          "request": {
            "method": "PUT",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"name\":\"T\",\"email\":\"t@t.com\",\"age\":25,\"hire_date\":\"2024-01-15\",\"phone\":\"+1\",\"address\":\"T\"}"},
            "url": "{{base_url}}/api/sellers/fake-999"
          }
        },
        {
          "name": "❌ Update - Bad Data",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));"]}}],
          "request": {
            "method": "PUT",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"name\":\"T\",\"email\":\"bad\",\"age\":15,\"hire_date\":\"bad\",\"phone\":\"+1\",\"address\":\"T\"}"},
            "url": "{{base_url}}/api/sellers/{{seller_id}}"
          }
        },
        {
          "name": "✅ Delete",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));", "pm.test('Success', () => pm.expect(pm.response.json().success).to.be.true);"]}}],
          "request": {"method": "DELETE", "url": "{{base_url}}/api/sellers/{{seller_id}}"}
        },
        {
          "name": "❌ Delete - Not Found",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 404', () => pm.response.to.have.status(404));"]}}],
          "request": {"method": "DELETE", "url": "{{base_url}}/api/sellers/fake-already-deleted"}
        }
      ]
    }
  ]
}
